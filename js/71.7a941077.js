"use strict";(self["webpackChunkvue3_pwa"]=self["webpackChunkvue3_pwa"]||[]).push([[71],{4071:function(t,e,i){i.r(e),i.d(e,{default:function(){return Yt}});var o=i(3396),l=i(7139);const a={class:"container-page-recipe"},s={class:"recipeDetail-list"},n={class:"recipeDetail-title"},r={class:"recipeDetail-content"},d={class:"recipeDetail-btn"},c=["onClick"],u=(0,o._)("i",{class:"bi bi-pencil-fill"},null,-1),p=[u],h=["onClick"],m=(0,o._)("i",{class:"bi bi-trash3-fill"},null,-1),_=[m],f={class:"addBtn"},g=(0,o._)("i",{class:"bi bi-plus-lg"},null,-1),b=[g];function D(t,e,i,u,m,g){const D=(0,o.up)("loading"),y=(0,o.up)("RecipeModal"),v=(0,o.up)("RecipeEditModal"),N=(0,o.up)("RecipeDelModal");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",a,[(0,o._)("ul",s,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(m.recipelist.list,((t,e)=>((0,o.wg)(),(0,o.iD)("li",{class:"recipeDetail-type",key:t.recipe_id},[(0,o._)("div",n,[(0,o._)("h3",null,(0,l.zw)(t.name),1)]),(0,o._)("div",r,[(0,o._)("p",null,[(0,o.Uk)("碳水化合物： "),(0,o._)("span",null,(0,l.zw)(m.recipelist.nutrition_detail[e].totalCarbohydrates),1),(0,o.Uk)("（Cal）")]),(0,o._)("p",null,[(0,o.Uk)("蛋白質： "),(0,o._)("span",null,(0,l.zw)(m.recipelist.nutrition_detail[e].totalProtein),1),(0,o.Uk)("（Cal）")]),(0,o._)("p",null,[(0,o.Uk)("脂肪： "),(0,o._)("span",null,(0,l.zw)(m.recipelist.nutrition_detail[e].totalFat),1),(0,o.Uk)("（Cal）")]),(0,o._)("p",null,[(0,o.Uk)("總卡路里： "),(0,o._)("span",null,(0,l.zw)(m.recipelist.nutrition_detail[e].totalCalories),1),(0,o.Uk)("（Cal）")])]),(0,o._)("div",d,[(0,o._)("button",{type:"button",class:"btn btn-outline-primary",onClick:e=>g.openModal("editModal",t)},p,8,c),(0,o._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>g.openModal("delModal",t)},_,8,h)])])))),128))]),(0,o._)("div",f,[(0,o._)("button",{type:"button",onClick:e[0]||(e[0]=t=>g.openModal(""))},b)])]),(0,o.Wm)(D,{active:t.isLoading},null,8,["active"]),(0,o.Wm)(y,{"category-data":m.localCategoryID,"info-detail":m.recipe_InfoDetails,onAddRecipe:e[1]||(e[1]=t=>g.closeModal(""))},null,8,["category-data","info-detail"]),(0,o.Wm)(v,{"info-detail":m.recipe_InfoDetails,onEditRecipe:e[2]||(e[2]=t=>g.closeModal("editModal"))},null,8,["info-detail"]),(0,o.Wm)(N,{"info-detail":m.recipe_InfoDetails,onDeleteRecipe:e[3]||(e[3]=t=>g.closeModal("delModal"))},null,8,["info-detail"])],64)}var y=i(2166),v=i(5513),N=i.n(v),M=i(65),C=i(9242);const w={id:"recipeModal",ref:"recipeModal",class:"modal fade",tabindex:"-1","aria-labelledby":"recipeModalLabel","aria-hidden":"true"},k={class:"modal-dialog modal-xl container-modal"},I={class:"modal-header bg-dark text-white"},x={id:"recipeModalLabel",class:"modal-title"},$={class:"modal-body"},E={class:"row"},R={class:"col-sm body-content"},L={class:"content-header"},z={class:"form-group col content-recipeName"},U={class:"nutrition-label"},J=(0,o._)("label",{for:"nutrition"},"食材選擇：",-1),V=(0,o._)("option",{value:"",selected:"",disabled:""},"請選擇食材",-1),W=["value"],A={class:"form-group col content-nutritions"},O={class:"nutrition-selected"},P=(0,o._)("label",{for:""},"已加入：",-1),S={class:"nutrition-list"},H=(0,o._)("i",{class:"bi bi-trash3-fill"},null,-1),Z=(0,o._)("span",null," 清除",-1),q=[H,Z],F={class:"form-textarea mb-4"},B=(0,o._)("div",{class:"form-label"},[(0,o._)("label",{for:"step"},"步驟做法：")],-1),Y={class:"modal-footer"};function j(t,e,i,a,s,n){const r=(0,o.up)("v-field"),d=(0,o.up)("error-message"),c=(0,o.up)("v-form");return(0,o.wg)(),(0,o.iD)("div",w,[(0,o._)("div",k,[(0,o.Wm)(c,{class:"modal-content border-0"},{default:(0,o.w5)((({errors:t})=>[(0,o._)("div",I,[(0,o._)("h5",x,[(0,o._)("span",null,"新增"+(0,l.zw)(i.infoDetail.category_name)+"食譜",1)]),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e[0]||(e[0]=(...t)=>n.closeClearData&&n.closeClearData(...t))})]),(0,o._)("div",$,[(0,o._)("div",E,[(0,o._)("div",R,[(0,o._)("div",L,[(0,o._)("div",z,[(0,o.Wm)(r,{id:"recipe_name",name:"食譜名稱",type:"text",modelValue:i.infoDetail.name,"onUpdate:modelValue":e[1]||(e[1]=t=>i.infoDetail.name=t),placeholder:"請輸入食譜名稱",rules:{required:!0,max:10},class:(0,l.C_)({"is-invalid":t["食譜名稱"]})},null,8,["modelValue","class"]),(0,o.Wm)(d,{name:"食譜名稱",class:"invalid-feedback"})]),(0,o._)("div",U,[J,(0,o.wy)((0,o._)("select",{id:"nutrition","onUpdate:modelValue":e[2]||(e[2]=t=>s.selectedNutritionID=t)},[V,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.nutritions,(t=>((0,o.wg)(),(0,o.iD)("option",{value:t.nutrition_id,key:t.nutrition_id},(0,l.zw)(t.name),9,W)))),128))],512),[[C.bM,s.selectedNutritionID]]),(0,o._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e[3]||(e[3]=(...t)=>n.select_Nutrition&&n.select_Nutrition(...t))},"加入")])]),(0,o._)("div",A,[(0,o._)("div",O,[P,(0,o._)("ul",S,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.selectedNutritions,(t=>((0,o.wg)(),(0,o.iD)("li",{class:"nutrition-item",key:t.nutrition_id},[(0,o._)("span",null,(0,l.zw)(t.name),1)])))),128))]),(0,o._)("button",{type:"button",class:"btn btn-danger",onClick:e[4]||(e[4]=(...t)=>n.remove_Nutrition&&n.remove_Nutrition(...t))},q)])]),(0,o._)("div",F,[B,(0,o.wy)((0,o._)("textarea",{id:"step",type:"text",name:"textarea",class:"form-control",rows:"10",cols:"20","onUpdate:modelValue":e[5]||(e[5]=t=>i.infoDetail.step=t),required:""},null,512),[[C.nr,i.infoDetail.step]])])])])]),(0,o._)("div",Y,[(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:e[6]||(e[6]=(...t)=>n.confirmPost&&n.confirmPost(...t))},"發佈")])])),_:1})])],512)}i(7658);var K=i(5708),T=i(3990),Q=i(579),G=i(2389),X=i(8456);Object.keys(T.ZP).forEach((t=>{(0,K.aH)(t,T.ZP[t])})),(0,K.jQ)({generateMessage:(0,Q.NC)({zh_TW:G}),validateOnInput:!0}),(0,Q.i_)("zh_TW");var tt={data(){return{fixApi:"https://140.123.173.4",nutritions:[],selectedNutritions:[],selectedNutritionID:""}},methods:{getNutrition(){const t=`${this.fixApi}/nutrition`;this.$http.get(t).then((t=>{this.nutritions=t.data})).catch((t=>{console.log(t)}))},select_Nutrition(){if(""!==this.selectedNutritionID)if(this.selectedNutritions.length<4){const t=this.nutritions.find((t=>t.nutrition_id===this.selectedNutritionID));t&&this.selectedNutritions.push(t),this.selectedNutritionID=""}else(0,X.Jt)("食材最多只能選擇4項");else(0,X.Jt)("未選擇食材項目")},remove_Nutrition(){0!==this.selectedNutritions.length&&(this.selectedNutritions=[],this.selectedNutritionID="")},confirmPost(){this.$store.dispatch("startLoading");const t=`${this.fixApi}/recipe/${this.categoryData}`;""===this.infoDetailCopy.name||0===this.infoDetailCopy.nutrition.length||""===this.infoDetailCopy.step?((0,X.Jt)("尚有輸入欄位未填寫"),this.$store.dispatch("stopLoading")):this.$http.post(t,this.infoDetailCopy).then((t=>{this.$emit("addRecipe"),console.log(t.data),this.$store.dispatch("stopLoading"),(0,X.qp)(t.data.msg)})).catch((t=>{console.log(t),(0,X.Jt)(t.response.data.msg)}))},closeClearData(){this.selectedNutritionID="",this.selectedNutritions=[]}},computed:{infoDetailCopy(){const t={...this.infoDetail};return t.nutrition=this.selectedNutritions,t}},props:{infoDetail:{default:{}},categoryData:{default:""}},emits:["addRecipe"],components:{VField:K.gN,VForm:K.l0,ErrorMessage:K.Bc},created(){this.getNutrition(),this.selectedNutritionID="",this.selectedNutritions=[]}},et=i(89);const it=(0,et.Z)(tt,[["render",j]]);var ot=it;const lt={id:"recipeEditModal",ref:"recipeEditModal",class:"modal fade",tabindex:"-1","aria-labelledby":"recipeEditModalLabel","aria-hidden":"true"},at={class:"modal-dialog modal-xl container-modal"},st={class:"modal-header bg-dark text-white"},nt={id:"recipeEditModalLabel",class:"modal-title"},rt={class:"modal-body"},dt={class:"row"},ct={class:"col-sm body-content"},ut={class:"content-header"},pt={class:"form-group col content-recipeName"},ht={class:"nutrition-label"},mt=(0,o._)("label",{for:"nutrition"},"食材選擇：",-1),_t=(0,o._)("option",{value:"",selected:"",disabled:""},"請選擇食材",-1),ft=["value"],gt={class:"form-group col content-nutritions"},bt={class:"nutrition-selected"},Dt=(0,o._)("label",{for:""},"已加入：",-1),yt={class:"nutrition-list"},vt=(0,o._)("i",{class:"bi bi-trash3-fill"},null,-1),Nt=(0,o._)("span",null," 清除",-1),Mt=[vt,Nt],Ct={class:"form-textarea mb-4"},wt=(0,o._)("div",{class:"form-label"},[(0,o._)("label",{for:"step"},"步驟做法：")],-1),kt={class:"modal-footer"};function It(t,e,i,a,s,n){const r=(0,o.up)("v-field"),d=(0,o.up)("error-message"),c=(0,o.up)("v-form");return(0,o.wg)(),(0,o.iD)("div",lt,[(0,o._)("div",at,[(0,o.Wm)(c,{class:"modal-content border-0"},{default:(0,o.w5)((({errors:t})=>[(0,o._)("div",st,[(0,o._)("h5",nt,[(0,o._)("span",null,"編輯"+(0,l.zw)(i.infoDetail.category_name)+"食譜",1)]),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e[0]||(e[0]=(...t)=>n.closeClearData&&n.closeClearData(...t))})]),(0,o._)("div",rt,[(0,o._)("div",dt,[(0,o._)("div",ct,[(0,o._)("div",ut,[(0,o._)("div",pt,[(0,o.Wm)(r,{id:"recipe_name",name:"食譜名稱",type:"text",modelValue:i.infoDetail.name,"onUpdate:modelValue":e[1]||(e[1]=t=>i.infoDetail.name=t),placeholder:"請輸入食譜名稱",rules:{required:!0,max:10},class:(0,l.C_)({"is-invalid":t["食譜名稱"]})},null,8,["modelValue","class"]),(0,o.Wm)(d,{name:"食譜名稱",class:"invalid-feedback"})]),(0,o._)("div",ht,[mt,(0,o.wy)((0,o._)("select",{id:"nutrition","onUpdate:modelValue":e[2]||(e[2]=t=>s.selectedNutritionID=t)},[_t,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.nutritions,(t=>((0,o.wg)(),(0,o.iD)("option",{value:t.nutrition_id,key:t.nutrition_id},(0,l.zw)(t.name),9,ft)))),128))],512),[[C.bM,s.selectedNutritionID]]),(0,o._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e[3]||(e[3]=(...t)=>n.select_Nutrition&&n.select_Nutrition(...t))},"加入")])]),(0,o._)("div",gt,[(0,o._)("div",bt,[Dt,(0,o._)("ul",yt,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.selectedNutritions,(t=>((0,o.wg)(),(0,o.iD)("li",{class:"nutrition-item",key:t.nutrition_id},[(0,o._)("span",null,(0,l.zw)(t.name),1)])))),128))]),(0,o._)("button",{type:"button",class:"btn btn-danger",onClick:e[4]||(e[4]=(...t)=>n.remove_Nutrition&&n.remove_Nutrition(...t))},Mt)])]),(0,o._)("div",Ct,[wt,(0,o.wy)((0,o._)("textarea",{id:"step",type:"text",name:"textarea",class:"form-control",rows:"10",cols:"20","onUpdate:modelValue":e[5]||(e[5]=t=>i.infoDetail.step=t),required:""},null,512),[[C.nr,i.infoDetail.step]])])])])]),(0,o._)("div",kt,[(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:e[6]||(e[6]=(...t)=>n.confirmEdit&&n.confirmEdit(...t))},"更新")])])),_:1})])],512)}Object.keys(T.ZP).forEach((t=>{(0,K.aH)(t,T.ZP[t])})),(0,K.jQ)({generateMessage:(0,Q.NC)({zh_TW:G}),validateOnInput:!0}),(0,Q.i_)("zh_TW");var xt={data(){return{fixApi:"https://140.123.173.4",nutritions:[],selectedNutritions:[],selectedNutritionID:""}},methods:{getNutrition(){const t=`${this.fixApi}/nutrition`;this.$http.get(t).then((t=>{this.nutritions=t.data})).catch((t=>{console.log(t)}))},getSelectedNutritions(){if(this.infoDetail&&this.infoDetail.nutrition)try{this.selectedNutritions=JSON.parse(this.infoDetail.nutrition)}catch(t){console.error("Error parsing infoDetail.nutrition:",t),this.selectedNutritions=[]}},select_Nutrition(){if(""!==this.selectedNutritionID)if(this.selectedNutritions.length<4){const t=this.nutritions.find((t=>t.nutrition_id===this.selectedNutritionID));t&&this.selectedNutritions.push(t),this.selectedNutritionID=""}else(0,X.Jt)("食材最多只能選擇4項");else(0,X.Jt)("未選擇食材項目")},remove_Nutrition(){0!==this.selectedNutritions.length&&(this.selectedNutritions=[],this.selectedNutritionID="")},confirmEdit(){this.$store.dispatch("startLoading");const t=`${this.fixApi}/recipe/${this.infoDetail.category_id}/${this.infoDetail.recipe_id}`;""===this.infoDetailCopy.name||0===this.infoDetailCopy.nutrition.length||""===this.infoDetailCopy.step?((0,X.Jt)("尚有輸入欄位未填寫"),this.$store.dispatch("stopLoading")):this.$http.put(t,this.infoDetailCopy).then((t=>{this.$emit("editRecipe"),console.log(t.data),this.$store.dispatch("stopLoading"),(0,X.qp)(t.data.msg)})).catch((t=>{console.log(t),(0,X.Jt)(t.response.data.msg)}))},closeClearData(){this.selectedNutritionID="",this.selectedNutritions=[]}},watch:{infoDetail:{handler(){this.getSelectedNutritions()},deep:!0,immediate:!0}},computed:{infoDetailCopy(){const t={...this.infoDetail};return t.nutrition=this.selectedNutritions,t}},props:{infoDetail:{type:Object,default:()=>({})}},emits:["editRecipe"],components:{VField:K.gN,VForm:K.l0,ErrorMessage:K.Bc},created(){this.getNutrition(),this.selectedNutritionID=""}};const $t=(0,et.Z)(xt,[["render",It]]);var Et=$t;const Rt={id:"recipeDelModal",ref:"recipeDelModal",class:"modal fade",tabindex:"-1","aria-labelledby":"recipeDelModalLabel","aria-hidden":"true"},Lt={class:"modal-dialog"},zt={class:"modal-content border-0"},Ut={class:"modal-header bg-danger text-white"},Jt={id:"recipeDelModalLabel",class:"modal-title"},Vt=(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Wt={class:"modal-body"},At={class:"text-danger"},Ot={class:"modal-footer"},Pt=(0,o._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function St(t,e,i,a,s,n){return(0,o.wg)(),(0,o.iD)("div",Rt,[(0,o._)("div",Lt,[(0,o._)("div",zt,[(0,o._)("div",Ut,[(0,o._)("h5",Jt,[(0,o._)("span",null,"刪除"+(0,l.zw)(i.infoDetail.category_name)+"食譜",1)]),Vt]),(0,o._)("div",Wt,[(0,o.Uk)(" 是否刪除 "),(0,o._)("strong",At,(0,l.zw)(i.infoDetail.name),1),(0,o.Uk)(" 食譜(刪除後將無法恢復)。 ")]),(0,o._)("div",Ot,[Pt,(0,o._)("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...t)=>n.confirmDel&&n.confirmDel(...t))},"確認刪除")])])])],512)}var Ht={data(){return{fixApi:"https://140.123.173.4"}},methods:{confirmDel(){this.$store.dispatch("startLoading");const t=`${this.fixApi}/recipe/${this.infoDetail.category_id}/${this.infoDetail.recipe_id}`;this.$http.delete(t).then((t=>{this.$emit("deleteRecipe"),console.log(t.data),this.$store.dispatch("stopLoading"),(0,X.qp)(t.data.msg)})).catch((t=>{console.log(t),(0,X.Jt)(t.response.data.msg)}))}},props:{infoDetail:{default:{}}},emits:["deleteRecipe"]};const Zt=(0,et.Z)(Ht,[["render",St]]);var qt=Zt,Ft={data(){return{fixApi:"https://140.123.173.4",localCategoryID:this.category_id,recipelist:{list:[],nutrition_detail:[]},recipe_InfoDetails:{},recipeModal:{},recipeEditModal:{},recipeDelModal:{}}},methods:{getRecipeCategory(){this.$store.dispatch("startLoading");const t=`${this.fixApi}/recipe/${this.localCategoryID}`;this.$http.get(t).then((t=>{this.recipelist.list=t.data,this.countCalories(this.recipelist.list),this.$store.dispatch("stopLoading")}))},countCalories(t){const e=Array.from(t);0!==e.length&&e.forEach(((t,e)=>{const i={no:"",totalCalories:0,totalProtein:0,totalCarbohydrates:0,totalFat:0},o=JSON.parse(t.nutrition);o.forEach((t=>{i.no=e,i.totalCalories+=Math.round(t.calories),i.totalProtein+=Math.round(t.protein),i.totalCarbohydrates+=Math.round(t.carbohydrates),i.totalFat+=Math.round(t.fat)})),this.recipelist.nutrition_detail[e]=i}))},openModal(t,e){""===t?(this.recipe_InfoDetails={},this.recipeModal.show()):"editModal"===t?(this.recipe_InfoDetails=JSON.parse(JSON.stringify(e)),this.recipeEditModal.show()):"delModal"===t?(this.recipe_InfoDetails=JSON.parse(JSON.stringify(e)),this.recipeDelModal.show()):console.log("openModal Error！！")},closeModal(t){""===t?this.recipeModal.hide():"editModal"===t?this.recipeEditModal.hide():"delModal"===t?this.recipeDelModal.hide():console.log("closeModal Error！！"),this.getRecipeCategory()}},computed:{...(0,M.Se)(["isLoading"])},props:{category_id:String},components:{RecipeModal:ot,RecipeEditModal:Et,RecipeDelModal:qt,Loading:N()},created(){this.getRecipeCategory()},mounted(){this.recipeModal=new y.Modal(document.getElementById("recipeModal")),this.recipeEditModal=new y.Modal(document.getElementById("recipeEditModal")),this.recipeDelModal=new y.Modal(document.getElementById("recipeDelModal"))},beforeRouteUpdate(t,e){const i=t.path,o=e.path;console.log(i),console.log(o),this.localCategoryID=t.params.category_id,this.getRecipeCategory()}};const Bt=(0,et.Z)(Ft,[["render",D]]);var Yt=Bt}}]);
//# sourceMappingURL=71.7a941077.js.map